{{/* Ensure Mermaid is available for landing pages where blocks render after <head>. */}}
{{ if and (eq .Type "landing") (not (.Page.Store.Get "has_mermaid")) }}
  {{ $sections := .Params.sections }}
  {{ if $sections }}
    {{ $sections_json := $sections | jsonify }}
    {{ if findRE "```mermaid" $sections_json }}
      {{ $mermaid_js := resources.Get "dist/lib/mermaid/mermaid.min.js" }}
      {{ $mermaid_config_js := resources.Get "js/hb-mermaid-config.js" | resources.Minify }}
      {{ $mermaid_bundle := slice $mermaid_js $mermaid_config_js | resources.Concat "js/mermaid.bundle.js" | resources.Fingerprint "sha256" }}
      <script defer src="{{ $mermaid_bundle.RelPermalink }}" integrity="{{ $mermaid_bundle.Data.Integrity }}"></script>
    {{ end }}
  {{ end }}
{{ end }}
